<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Chat Viewer</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{
--bg:#0b141a;--panel:#202c33;--sent:#005c4b;--recv:#202c33;
--text:#e9edef;--sub:#8696a0;--accent:#00a884;
}
.light{
--bg:#efeae2;--panel:#ffffff;--sent:#dcf8c6;--recv:#ffffff;
--text:#111b21;--sub:#667781;
}
body{
margin:0;display:flex;justify-content:center;
font-family:Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)
}
.app{max-width:420px;width:100%;height:100vh;display:flex;flex-direction:column}

/* HEADER */
.header{
background:var(--panel);
padding:10px;
display:flex;
justify-content:space-between;
align-items:center;
}
.menu-btn{
background:none;border:none;color:white;font-size:20px;cursor:pointer
}

/* DROPDOWN */
.dropdown{
position:absolute;
top:56px;
right:10px;
width:320px;
background:var(--panel);
border-radius:10px;
padding:10px;
display:none;
z-index:1000;
box-shadow:0 10px 30px rgba(0,0,0,.5)
}
.dropdown.show{display:block}

.controls-row{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
button{background:var(--accent);border:none;border-radius:6px;padding:6px 10px;cursor:pointer}
.search-box{flex:1;padding:6px;border-radius:6px;border:none}

/* CHAT */
.chat{
flex:1;overflow-y:auto;padding:10px;
background:var(--bg);background-size:cover;background-position:center
}
.bubble{max-width:75%;margin:6px 0;padding:8px;border-radius:8px}
.sent{margin-left:auto;background:var(--sent)}
.received{background:var(--recv)}
.sender{font-size:12px;font-weight:bold;color:#53bdeb}
.text{white-space:pre-wrap}
.time{font-size:11px;color:var(--sub);text-align:right}

/* MEDIA */
.media{max-width:100%;border-radius:6px;margin-top:6px}
.media-wrap{position:relative}
.fs-btn{
position:absolute;top:6px;right:6px;
background:rgba(0,0,0,.6);color:white;border:none
}
.sticker{
max-width:160px;
margin-top:6px;
}

/* VOICE */
.voice{
display:flex;align-items:center;gap:6px;
background:#1f2c33;border-radius:20px;padding:6px;margin-top:6px
}
.voice button{background:none;color:white;border:none;font-size:14px}
.voice input[type=range]{
flex:1;height:4px;border-radius:2px;background:#555
}
.voice input[type=range]::-webkit-slider-thumb{
appearance:none;width:12px;height:12px;border-radius:50%;
background:#00a884
}
.voice-time{font-size:11px;color:#ccc}

/* DATE */
.date{
margin:10px auto;background:#111b21;color:white;
font-size:12px;padding:4px 10px;border-radius:8px;width:fit-content
}

/* FULLSCREEN */
.fullscreen{
position:fixed;inset:0;background:black;
display:none;align-items:center;justify-content:center;z-index:9999
}
.fullscreen img,.fullscreen video{max-width:100%;max-height:100%}
.exit{position:absolute;top:10px;right:10px;font-size:20px}

/* SEARCH */
.search-results{
background:#111b21;max-height:200px;overflow-y:auto;
border-radius:6px;margin-top:6px
}
.search-item{
padding:6px;border-bottom:1px solid #202c33;
cursor:pointer;font-size:13px
}
.search-item:hover{background:#202c33}
.highlight{
outline:2px solid var(--accent);
animation:fade 2s forwards
}
@keyframes fade{to{outline-color:transparent}}
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <span>WhatsApp Chat Viewer</span>
    <div>
      <button onclick="toggleMode()">üåì</button>
      <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    </div>
  </div>

  <!-- DROPDOWN -->
  <div id="menu" class="dropdown">
    <input type="file" id="zip" accept=".zip">

    <div class="controls-row">
      <input id="q" class="search-box" placeholder="Search messages">
      <button onclick="search()">üîç</button>
    </div>

    <div class="controls-row">
      <button onclick="pickWallpaper()">üñº Wallpaper</button>
      <button onclick="exportPDF()">PDF</button>
    </div>

    <div id="searchResults" class="search-results"></div>
  </div>

  <div id="chat" class="chat"></div>
</div>

<input type="file" id="wallpaperPicker" accept="image/*" hidden>

<div id="fs" class="fullscreen">
  <button class="exit" onclick="closeFS()">‚úï</button>
</div>

<script>
let bubbles=[];
let currentAudio=null;
let currentBtn=null;

const chat=document.getElementById("chat");
const fs=document.getElementById("fs");
const resultsDiv=document.getElementById("searchResults");
const menu=document.getElementById("menu");

/* MENU */
function toggleMenu(){menu.classList.toggle("show")}
document.addEventListener("click",e=>{
if(!menu.contains(e.target) && !e.target.classList.contains("menu-btn")){
menu.classList.remove("show");
}
});

/* LOAD ZIP */
document.getElementById("zip").onchange=async e=>{
const zip=await JSZip.loadAsync(e.target.files[0]);
let txt=null,media={};

for(const p in zip.files){
const n=p.split("/").pop();
if(n.endsWith(".txt")) txt=await zip.files[p].async("string");
else if(/\.(jpg|png|jpeg|webp|mp4|mp3|opus|ogg)$/i.test(n))
media[n]=URL.createObjectURL(await zip.files[p].async("blob"));
}
render(txt,media);
menu.classList.remove("show");
};

/* RENDER */
function render(text,media){
chat.innerHTML="";bubbles=[];resultsDiv.innerHTML="";
const lines=text.split(/\r?\n/);
let cur=null,msgs=[];
const r=/^(\d+\/\d+\/\d+),\s(\d+:\d+).*?- ([^:]+): (.*)$/;

for(const l of lines){
const m=l.match(r);
if(m){if(cur)msgs.push(cur);cur={d:m[1],t:m[2],s:m[3],x:m[4]};}
else if(cur)cur.x+="\n"+l;
}
if(cur)msgs.push(cur);

let last=null,me=msgs[0]?.s;

msgs.forEach(m=>{
if(m.d!==last){
const d=document.createElement("div");
d.className="date";d.textContent=m.d;
chat.appendChild(d);last=m.d;
}

const b=document.createElement("div");
b.className="bubble "+(m.s===me?"sent":"received");
b.innerHTML=`
<div class="sender">${m.s}</div>
<div class="text">${m.x}</div>
<div class="time">${m.t}</div>
`;

const f=m.x.match(/((IMG|VID|PTT|STK)-\d+-WA\d+\.\w+|\S+\.webp)/i)?.[0];

if(f && media[f]){
const w=document.createElement("div");w.className="media-wrap";

if(/\.(jpg|png|jpeg)$/i.test(f) || f.startsWith("IMG")){
w.innerHTML=`<img class="media" src="${media[f]}" onclick="openFS(this)">
<button class="fs-btn" onclick="openFS(this.previousElementSibling)">‚õ∂</button>`;
}
else if(/\.(mp4|webm|ogg)$/i.test(f)){
w.innerHTML=`<video class="media" src="${media[f]}" controls loop playsinline onclick="openFS(this,true)"></video>
<button class="fs-btn" onclick="openFS(this.previousElementSibling,true)">‚õ∂</button>`;
}
else if(/\.(opus|mp3)$/i.test(f)){
const id="a"+Math.random();
w.innerHTML=`
<div class="voice">
<button onclick="togglePlay('${id}',this)">‚ñ∂</button>
<input type="range" min="0" value="0" step="0.1" oninput="seek('${id}',this)">
<span class="voice-time" id="${id}-t">0:00</span>
<button onclick="speed('${id}',this)">1√ó</button>
<audio id="${id}" src="${media[f]}" ontimeupdate="updateBar('${id}')" onended="resetAudio(this)"></audio>
</div>`;
}
else if(f.endsWith(".webp")){
w.innerHTML=`<img class="sticker" src="${media[f]}">`;
}
b.appendChild(w);
}

chat.appendChild(b);
bubbles.push(b);
});
}

/* VOICE */
function togglePlay(id,btn){
const a=document.getElementById(id);
if(currentAudio && currentAudio!==a){
currentAudio.pause();currentAudio.currentTime=0;
if(currentBtn)currentBtn.textContent="‚ñ∂";
}
if(a.paused){
a.play();btn.textContent="‚è∏";
currentAudio=a;currentBtn=btn;
}else{
a.pause();btn.textContent="‚ñ∂";
currentAudio=null;currentBtn=null;
}
}
function resetAudio(a){
if(a===currentAudio){currentBtn.textContent="‚ñ∂";currentAudio=null;currentBtn=null;}
}
function seek(id,s){document.getElementById(id).currentTime=s.value}
function updateBar(id){
const a=document.getElementById(id);
const s=a.parentElement.querySelector("input");
if(!s.max)s.max=a.duration;
s.value=a.currentTime;
document.getElementById(id+"-t").textContent=format(a.currentTime);
}
function speed(id,b){
const a=document.getElementById(id);
a.playbackRate=a.playbackRate===1?1.5:a.playbackRate===1.5?2:1;
b.textContent=a.playbackRate+"√ó";
}
function format(t){
return Math.floor(t/60)+":"+(Math.floor(t%60)).toString().padStart(2,"0");
}

/* SEARCH */
function search(){
resultsDiv.innerHTML="";
const q=document.getElementById("q").value.toLowerCase().trim();
if(!q)return;
bubbles.forEach(b=>{
if(b.textContent.toLowerCase().includes(q)){
const i=document.createElement("div");
i.className="search-item";
i.textContent=b.querySelector(".text")?.textContent.slice(0,60)+"‚Ä¶";
i.onclick=()=>{
b.scrollIntoView({behavior:"smooth",block:"center"});
b.classList.add("highlight");
setTimeout(()=>b.classList.remove("highlight"),2000);
menu.classList.remove("show");
};
resultsDiv.appendChild(i);
}
});
}

/* FULLSCREEN */
function openFS(el,isVid){
fs.innerHTML=`<button class="exit" onclick="closeFS()">‚úï</button>`;
const c=el.cloneNode(true);
if(isVid){c.controls=true;c.loop=true;c.playsInline=true;}
fs.appendChild(c);fs.style.display="flex";
}
function closeFS(){fs.style.display="none"}

/* PDF */
function exportPDF(){
const clone=chat.cloneNode(true);
clone.querySelectorAll("video,button,input").forEach(e=>e.remove());
html2pdf().from(clone).set({filename:"WhatsAppChat.pdf"}).save();
menu.classList.remove("show");
}

/* MODE */
function toggleMode(){document.body.classList.toggle("light")}

/* WALLPAPER */
function pickWallpaper(){document.getElementById("wallpaperPicker").click()}
document.getElementById("wallpaperPicker").onchange=e=>{
chat.style.backgroundImage=`url(${URL.createObjectURL(e.target.files[0])})`;
menu.classList.remove("show");
};
</script>
</body>
</html>